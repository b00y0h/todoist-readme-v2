# Codebase Structure

**Analysis Date:** 2026-02-11

## Directory Layout

```
todoist-readme/
├── index.js                 # Main action logic (fetch, transform, persist)
├── exec.js                  # Child process execution wrapper
├── action.yml               # GitHub Action manifest
├── package.json             # Node.js dependencies and scripts
├── package-lock.json        # Locked dependency versions
├── README.md                # User documentation and setup guide
├── LICENSE                  # ISC license
├── .gitignore               # Git ignore rules
├── dist/
│   └── index.js             # Bundled output (generated by ncc build)
├── assets/
│   └── todoist-stat.png     # Marketing/documentation image
└── .planning/
    └── codebase/            # GSD codebase analysis documents
```

## Directory Purposes

**Root Directory:**
- Purpose: GitHub Action source code and configuration
- Contains: Executable entry points, configuration, documentation
- Key files: `index.js`, `action.yml`, `package.json`

**dist/ Directory:**
- Purpose: Bundled, self-contained action distribution
- Contains: Compiled JavaScript with all dependencies inlined via `@zeit/ncc`
- Generated: Yes (via `npm run build`)
- Committed: Yes (required for GitHub Actions distribution)
- Key files: `dist/index.js` (107KB bundled output)

**assets/ Directory:**
- Purpose: Static resources for documentation and branding
- Contains: PNG images for README display
- Generated: No
- Committed: Yes
- Key files: `todoist-stat.png` (58KB)

**.planning/codebase/ Directory:**
- Purpose: GSD codebase analysis and planning documents
- Contains: Architecture analysis, structure maps, conventions, concerns
- Generated: By GSD mapping commands
- Committed: Yes (for orchestrator reference)

## Key File Locations

**Entry Points:**
- `dist/index.js`: GitHub Actions runtime entry point (bundled)
- `index.js`: Source entry point, contains main workflow logic
- `exec.js`: Subprocess command execution utility

**Configuration:**
- `action.yml`: GitHub Action interface definition (inputs, outputs, runtime)
- `package.json`: Node.js runtime configuration, dependencies, build scripts
- `.gitignore`: Git exclusion rules

**Core Logic:**
- `index.js`: Main API fetch → transform → README update → git commit pipeline
  - `main()`: Orchestration and API call
  - `updateReadme()`: Stats formatting and README update decision
  - `buildReadme()`: Template tag location and content injection
  - `commitReadme()`: Git operations (config, add, commit, push)
- `exec.js`: Cross-platform child process execution with promise API

**Testing:**
- No dedicated test files (test script in package.json is placeholder: "echo \"Error: no test specified\" && exit 1")
- TEST_MODE environment variable gates actual git operations in `index.js` line 64

## Naming Conventions

**Files:**
- `index.js`: Convention for Node.js package entry points
- `action.yml`: GitHub Actions standard manifest filename
- `exec.js`: Utility module following lowercase-with-dash convention (not used here, but typical)
- Bundled output: `dist/index.js` (standard distribution directory name)

**Functions:**
- `main()`: Entry point function, async IIFE wrapper
- `updateReadme()`: Main transformation function
- `buildReadme()`: Helper for README template manipulation
- `commitReadme()`: Helper for git operations
- `exec()`: Subprocess execution utility (lowercase)

**Variables:**
- `TODOIST_API_KEY`, `PREMIUM`: Environment inputs (SCREAMING_SNAKE_CASE)
- `todoist`: Global array accumulating formatted stats (lowercase)
- `jobFailFlag`: Global state tracking job success (camelCase)
- `README_FILE_PATH`: File path constant (SCREAMING_SNAKE_CASE)
- `tagToLookFor`, `closingTag`: Search pattern strings (camelCase)

**Types/Constants:**
- `TODO-IST`: Template tag prefix (hyphenated, all caps)
- START/END: Template tag markers

## Where to Add New Code

**New Feature:**
- Primary code: `index.js` (add transformation logic to `updateReadme()` or create new function)
- Utilities: `exec.js` pattern for subprocess operations or create new utility file
- Tests: Create `index.test.js` or `__tests__/index.js` (currently no test infrastructure)

**New Component/Module:**
- Implementation: Add as separate `.js` file in root (e.g., `stats-formatter.js`, `git-operations.js`)
- Import in: `index.js` main orchestration flow
- Export: Use `module.exports` for CommonJS

**Utilities:**
- Shared helpers: `exec.js` is model for subprocess utilities
- File I/O helpers: Add to root, import as needed in `index.js`
- API request helpers: Extract axios configuration to separate module if adding more endpoints

**Build Output:**
- `npm run build`: Runs `ncc build index.js -o dist`
- After modifying source, regenerate dist/ via build script before committing

## Special Directories

**dist/ - Bundled Distribution:**
- Purpose: GitHub Actions requires all dependencies to be bundled or checked in
- Generated: Yes, via `npm run build` (runs @zeit/ncc compiler)
- Committed: Yes, distribution files are checked in for portability
- Process: Source `index.js` → ncc bundles all requires → `dist/index.js` (107KB)
- When to update: After any changes to `index.js` or dependencies (always run build before commit)

**node_modules/ - Dependencies:**
- Purpose: Installed Node.js packages (NOT in repo)
- Generated: Yes, via `npm install`
- Committed: No (in `.gitignore`)
- Contents: axios, @actions/core, humanize-plus, child_process, process wrapper packages

**assets/ - Static Resources:**
- Purpose: Images and media for documentation
- Generated: No
- Committed: Yes
- Referenced in: README.md

---

*Structure analysis: 2026-02-11*
