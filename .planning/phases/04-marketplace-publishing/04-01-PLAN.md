---
phase: 04-marketplace-publishing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - README.md
  - CHANGELOG.md
  - action.yml
autonomous: true
user_setup: []

must_haves:
  truths:
    - "README has complete usage documentation with workflow examples"
    - "README has migration guide with breaking changes and upgrade steps"
    - "README has setup instructions for API key and secrets"
    - "CHANGELOG documents v2.0.0 changes with breaking change markers"
    - "action.yml has updated metadata for marketplace"
  artifacts:
    - path: "README.md"
      provides: "Complete user documentation"
      contains: "## Usage"
    - path: "README.md"
      provides: "Migration guidance"
      contains: "## Migration Guide"
    - path: "CHANGELOG.md"
      provides: "Version history"
      contains: "## [2.0.0]"
    - path: "action.yml"
      provides: "Marketplace metadata"
      contains: "description:"
  key_links:
    - from: "README.md"
      to: "action.yml"
      via: "Input documentation matches action.yml inputs"
      pattern: "TODOIST_API_KEY.*PREMIUM"
---

<objective>
Create comprehensive documentation and metadata for GitHub Marketplace publishing.

Purpose: Users need clear setup instructions, workflow examples, and migration guidance to adopt v2. Marketplace requires complete action.yml metadata for discoverability.

Output: README.md with usage/migration docs, CHANGELOG.md with version history, updated action.yml metadata
</objective>

<execution_context>
@/home/claude/.claude/get-shit-done/workflows/execute-plan.md
@/home/claude/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-marketplace-publishing/04-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update action.yml with marketplace metadata</name>
  <files>action.yml</files>
  <action>
Update action.yml with complete marketplace metadata:

1. **Update action name and description:**
   - name: 'Todoist Stats for README'
   - description: 'Display your Todoist productivity stats (karma, streaks, completed tasks) in your GitHub profile README'
   - author: Keep existing or update as appropriate

2. **Add/verify branding section** (already has icon: activity, color: red - keep these)

3. **Update input descriptions for clarity:**
   - TODOIST_API_KEY: 'Your Todoist API token from Integrations settings'
   - PREMIUM: 'Set to "true" if you have Todoist Premium for weekly stats (default: "false")'

4. **Remove deprecated USERNAME input** - no longer used after Phase 3 actor detection

5. **Add outputs section:**
   ```yaml
   outputs:
     stats_updated:
       description: 'Whether stats were updated ("true" or "false")'
   ```

Note: Keep `runs.using: "node20"` and `runs.main: "dist/index.js"` unchanged.
  </action>
  <verify>
Verify action.yml:
- `grep -q "Todoist Stats" action.yml` (updated name)
- `grep -q "productivity stats" action.yml` (descriptive)
- `grep -q "branding:" action.yml` (has branding)
- `! grep -q "USERNAME:" action.yml` (deprecated input removed)
- `grep -q "outputs:" action.yml` (has outputs)
  </verify>
  <done>action.yml has complete marketplace metadata, deprecated inputs removed, outputs declared</done>
</task>

<task type="auto">
  <name>Task 2: Rewrite README with complete documentation</name>
  <files>README.md</files>
  <action>
Replace README.md with comprehensive documentation following GitHub Actions best practices:

**Structure:**

1. **Header** (keep existing logo/assets reference if present):
   ```markdown
   # Todoist Stats for README

   Display your Todoist productivity stats in your GitHub profile README. Shows karma points, completed tasks, daily/weekly stats, and streaks.
   ```

2. **Features section:**
   - Karma points display
   - Daily completed tasks
   - Weekly completed tasks (Premium)
   - Total completed tasks
   - Current and longest streaks
   - Granular tag customization
   - Auto-updates via GitHub Actions

3. **Quick Start** (minimal example):
   ```yaml
   - uses: abhisheknaiidu/todoist-readme@v2
     with:
       TODOIST_API_KEY: ${{ secrets.TODOIST_API_KEY }}
   ```

4. **Setup section:**
   - Step 1: Get Todoist API token (link to https://todoist.com/prefs/integrations)
   - Step 2: Add token as repository secret (Settings > Secrets > Actions)
   - Step 3: Add workflow file
   - Step 4: Add tags to README.md

5. **Complete workflow example:**
   ```yaml
   name: Update Todoist Stats
   on:
     schedule:
       - cron: '0 0 * * *'  # Daily at midnight UTC
     workflow_dispatch:

   jobs:
     update-stats:
       runs-on: ubuntu-latest
       permissions:
         contents: write
       steps:
         - uses: actions/checkout@v4
         - uses: abhisheknaiidu/todoist-readme@v2
           with:
             TODOIST_API_KEY: ${{ secrets.TODOIST_API_KEY }}
             PREMIUM: "true"  # Set to "false" for free users
   ```

6. **Inputs table:**
   | Input | Required | Default | Description |
   |-------|----------|---------|-------------|
   | TODOIST_API_KEY | Yes | - | Your Todoist API token |
   | PREMIUM | No | "false" | Set to "true" for weekly stats |

7. **README Tags section:**

   **Legacy mode (all stats in one block):**
   ```markdown
   <!-- TODO-IST:START -->
   <!-- TODO-IST:END -->
   ```

   **Granular mode (individual stats anywhere):**
   - `<!-- TODO-IST-KARMA:START --><!-- TODO-IST-KARMA:END -->`
   - `<!-- TODO-IST-DAILY:START --><!-- TODO-IST-DAILY:END -->`
   - `<!-- TODO-IST-WEEKLY:START --><!-- TODO-IST-WEEKLY:END -->` (Premium)
   - `<!-- TODO-IST-TOTAL:START --><!-- TODO-IST-TOTAL:END -->`
   - `<!-- TODO-IST-CURRENT-STREAK:START --><!-- TODO-IST-CURRENT-STREAK:END -->`
   - `<!-- TODO-IST-LONGEST-STREAK:START --><!-- TODO-IST-LONGEST-STREAK:END -->`

8. **Migration Guide section** (see Task 3 template - include inline)

9. **License section** (keep existing CC0)

10. **Credits/Inspiration** (keep existing)

**Important:** Do NOT use promotional language or excessive emojis. Keep it technical and clear.
  </action>
  <verify>
Verify README.md:
- `grep -q "## Setup" README.md`
- `grep -q "## Quick Start" README.md` OR `grep -q "## Usage" README.md`
- `grep -q "TODOIST_API_KEY" README.md`
- `grep -q "permissions:" README.md` (workflow has permissions)
- `grep -q "TODO-IST:START" README.md` (legacy tags documented)
- `grep -q "TODO-IST-KARMA" README.md` (granular tags documented)
- `grep -q "## Migration" README.md`
  </verify>
  <done>README.md has complete setup, usage, tag documentation, and migration guide</done>
</task>

<task type="auto">
  <name>Task 3: Create CHANGELOG.md with v2.0.0 release notes</name>
  <files>CHANGELOG.md</files>
  <action>
Create CHANGELOG.md following Keep a Changelog format:

```markdown
# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/),
and this project adheres to [Semantic Versioning](https://semver.org/).

## [2.0.0] - 2026-02-11

### Breaking Changes

- **Node.js 20 runtime** - Upgraded from Node 16 (deprecated by GitHub)
- **Removed `USERNAME` input** - Committer identity now auto-detected from GitHub actor
- **API Migration** - Switched from deprecated Todoist Sync API v9 to unified API v1

### Added

- **Granular tag customization** - Place individual stats anywhere in README:
  - `TODO-IST-KARMA` - Karma points
  - `TODO-IST-DAILY` - Tasks completed today
  - `TODO-IST-WEEKLY` - Tasks this week (Premium)
  - `TODO-IST-TOTAL` - Total completed tasks
  - `TODO-IST-CURRENT-STREAK` - Current daily streak
  - `TODO-IST-LONGEST-STREAK` - Longest streak record
- **Current streak display** - Shows current daily streak with encouraging messages
- **Longest streak display** - Shows historical best streak
- **Auto-detected committer** - Uses GitHub actor identity instead of hardcoded values
- **Skip empty commits** - Only commits when README actually changes
- **Improved error handling** - Clear, actionable error messages for API failures
- **Rate limit handling** - Exponential backoff with Retry-After header support

### Changed

- Commit message updated to "Update Todoist stats" (was "Todoist updated.")
- Git config uses local scope (doesn't leak to other workflow steps)
- Premium input now expects string "true"/"false" (was boolean)

### Fixed

- API compatibility with Todoist unified API v1 (v9 deprecated Feb 10, 2026)
- Empty commits when stats unchanged
- Hardcoded author identity in commits

## [1.x.x] - Previous

See git history for previous versions. v1.x used the now-deprecated Todoist Sync API v9.
```

**Note:** Date should be current date. The version history accurately reflects work done in Phases 1-3.
  </action>
  <verify>
Verify CHANGELOG.md:
- `grep -q "## \[2.0.0\]" CHANGELOG.md`
- `grep -q "Breaking Changes" CHANGELOG.md`
- `grep -q "Node.js 20" CHANGELOG.md`
- `grep -q "Granular tag" CHANGELOG.md`
- `grep -q "USERNAME.*input" CHANGELOG.md`
- `grep -q "API v1" CHANGELOG.md`
  </verify>
  <done>CHANGELOG.md exists with v2.0.0 release notes including breaking changes, added features, and fixes</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **action.yml validates:**
   ```bash
   # Check YAML is valid
   python3 -c "import yaml; yaml.safe_load(open('action.yml'))" && echo "Valid YAML"
   ```

2. **README completeness:**
   ```bash
   # Check all required sections exist
   for section in "Setup" "Inputs" "Migration" "TODO-IST"; do
     grep -q "$section" README.md && echo "FOUND: $section" || echo "MISSING: $section"
   done
   ```

3. **CHANGELOG exists and is formatted:**
   ```bash
   [ -f CHANGELOG.md ] && grep -q "2.0.0" CHANGELOG.md && echo "CHANGELOG valid"
   ```
</verification>

<success_criteria>
- action.yml has updated name, description, branding, and outputs
- action.yml no longer has deprecated USERNAME input
- README.md has complete usage documentation with workflow examples
- README.md documents both legacy and granular tag modes
- README.md has migration guide section with breaking changes
- CHANGELOG.md exists with v2.0.0 section
- CHANGELOG.md lists all breaking changes and new features
</success_criteria>

<output>
After completion, create `.planning/phases/04-marketplace-publishing/04-01-SUMMARY.md`
</output>
