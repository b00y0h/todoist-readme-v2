---
phase: 01-api-migration-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - action.yml
  - package.json
  - package-lock.json
  - dist/index.js
autonomous: true

must_haves:
  truths:
    - "Action declares Node 20 runtime in action.yml"
    - "All dependencies are Node 20 compatible"
    - "Bundle builds without errors on Node 20"
  artifacts:
    - path: "action.yml"
      provides: "Node 20 runtime declaration"
      contains: 'using: "node20"'
    - path: "package.json"
      provides: "Updated dependencies"
      contains: "@actions/core"
    - path: "dist/index.js"
      provides: "Bundled action code"
      min_lines: 100
  key_links:
    - from: "action.yml"
      to: "dist/index.js"
      via: "runs.main"
      pattern: 'main: "dist/index.js"'
---

<objective>
Upgrade GitHub Action runtime to Node 20 and update all dependencies to compatible versions.

Purpose: Node 12 runtime is deprecated and no longer works on GitHub Actions runners. This is a prerequisite for any other changes.
Output: Action.yml declares node20, dependencies upgraded, bundle rebuilt successfully.
</objective>

<execution_context>
@/home/claude/.claude/get-shit-done/workflows/execute-plan.md
@/home/claude/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-api-migration-foundation/01-RESEARCH.md

@action.yml
@package.json
@index.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update action.yml runtime to Node 20</name>
  <files>action.yml</files>
  <action>
    Change the `runs.using` field from "node12" to "node20".

    This is the ONLY change needed in action.yml. The rest of the file (inputs, branding) remains unchanged.

    Why: GitHub Actions deprecated Node 12 and Node 16 runtimes. Node 20 is the current stable runtime. This is required for the action to execute at all.
  </action>
  <verify>Grep action.yml for `using: "node20"`</verify>
  <done>action.yml declares Node 20 runtime</done>
</task>

<task type="auto">
  <name>Task 2: Upgrade npm dependencies for Node 20 compatibility</name>
  <files>package.json, package-lock.json</files>
  <action>
    Run the following npm commands to upgrade dependencies:

    1. Upgrade @actions/core to latest (v1.10.0+ required for Node 20):
       `npm install @actions/core@latest`

    2. Upgrade axios to latest (v1.6.0+ for security patches):
       `npm install axios@latest`

    3. Replace @zeit/ncc with @vercel/ncc (rebranded, same functionality):
       `npm uninstall @zeit/ncc`
       `npm install -D @vercel/ncc@latest`

    4. Add axios-retry for rate limit handling (API-04 requirement):
       `npm install axios-retry@latest`

    5. Add Node engine constraint to package.json:
       Add `"engines": { "node": ">=20.0.0" }` field

    Keep humanize-plus, process, and child_process unchanged (already compatible).

    Also update build script to use new ncc path if needed (likely works as-is since ncc is in node_modules/.bin).
  </action>
  <verify>`npm ls` shows no peer dependency warnings, `npm audit` has no high/critical vulnerabilities</verify>
  <done>All dependencies upgraded to Node 20 compatible versions, axios-retry added</done>
</task>

<task type="auto">
  <name>Task 3: Rebuild bundle and verify</name>
  <files>dist/index.js</files>
  <action>
    1. Run the build command:
       `npm run build`

    2. Verify the bundle was created:
       - dist/index.js should exist
       - File should be larger than before (includes new dependencies)
       - No error output during build

    3. Basic syntax verification:
       `node --check dist/index.js` (verifies JavaScript syntax is valid for Node 20)

    Do NOT run the action yet (it will fail because API endpoint is still v9). Just verify the bundle builds.
  </action>
  <verify>`ls -la dist/index.js` shows recent timestamp, `node --check dist/index.js` exits 0</verify>
  <done>dist/index.js rebuilt with new dependencies, syntax valid for Node 20</done>
</task>

</tasks>

<verification>
- [ ] action.yml contains `using: "node20"`
- [ ] package.json shows @actions/core >= 1.10.0
- [ ] package.json shows axios >= 1.6.0
- [ ] package.json shows axios-retry (any version)
- [ ] package.json devDependencies shows @vercel/ncc (not @zeit/ncc)
- [ ] dist/index.js exists and has recent modification time
- [ ] `node --check dist/index.js` passes
</verification>

<success_criteria>
Action runtime upgraded to Node 20 with all dependencies compatible. Bundle builds successfully. Ready for API migration in Plan 02.
</success_criteria>

<output>
After completion, create `.planning/phases/01-api-migration-foundation/01-01-SUMMARY.md`
</output>
